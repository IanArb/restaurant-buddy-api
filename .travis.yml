sudo: required
language: java
jdk: oraclejdk8
env:
  global:
    - secure: QVohElGXZnx45E0K2np8TRnsc8GlBYzt6BByKVAk/g3o98oKTLqyHWwcVuo6O6+C7zRDNGXVNxY+Kaww8J4BUnzvaHKLCMUdFKM2nPYwx3YGQTQqezhsG94ConC9COqTz+wTdL6rBpgyBgroK29m9NGk/fsiIr7053fAhN1CP0RUkV6YXbz20k8SDhd4q1DknU7Atdgo9mEgEO7PhkiAX8Pv+n4ISwv/glPS+xSpec0jykLnWuUWSXIpaswuUNUr7q7aCYZwQq9B/VE01a9rWeH/6e305Eu7ODKXENKxVPSFau0JZaIY1XTAtM09ro9rOOrEaV8lXjUsfZsgdB67NS3uerDvBhuBlPJkHAXRBB4OsZaZZCRNcv9E0VyLdLcRibPdwfJaPJN1BdNrx898oL04eNXOEf6ANMPBi6Xl1eYBxKGvtOI0SpEF7JkVnJEdQQEE0RN+Wbv2K6pWH0OCV1aK0ItkgVqwJLhRvuf/KNLQ9qfrbBotiv2tfwDa8k0hY6pgYoNZ2/zUDrvjeGLYVH7b/uQM0nDNzGj3aiaBnv9wZxwQqT2tqoDFswB2VpIdkvhqrdd9chA3UqxHpFI6/LFoICD3+qh1OBX76DliR2S6s6ZbzJZKLb1UqNNEKKQ3mRT1mDARLWTR/db7XmYVhcLlbyMzGjbMSsGHYqPci7M=
    - secure: HxUNtZJkU/2BoZdIKM62I2CLGrYpsQDO7/6XOaD+Y5YIoI4+xSSVd+KCvMbCnQagakVDqsJ9AMOliXxgjOmVQ9KI6xQ4/jTxpTmpv4keMiIe0jU6w1M91NzHzrHuHawiX6XfI94CB5AKncOaGEBAsb2DzbVyIQ1ZDQN8OPoXf+734U1ZhrN/D3gCGtXElZYI1R5qf7L/MbtZgqvFKE6vQLG+dvGHOGPnuhVowwEZFGr/obQfbWTT5Qo2gYsSrYehaBbv+zYnaU7OH1VBK2ww2TiY7a88Xcjpuz+o9fCkhXsqpv3YdpgYG3bWZxli6VPEHxAuty5h7pg81c7TAAUZ1nQuPjQ5atey+M2ztVTs7dzZQQ0jMucnOZ0RNydAoh7NHjsrgntmmSe0QdSJstMSMOs9IOg58bCuQdlEUpV+d5XLtQiuNZAbpeC1R0xXkQnF0K96b1KWJwYIuZN3o/XWsDEN7XN5au9UqJlOSo4oX8UL5W5tKMfmIxQaexgr6G0wz8FWdlNOH5/T0iOOWDVmudlkh0LfnpLvC/AJmGhecb6Ur0q/3z44fezpS9lc9XqzTonMrwfDjrpYyKrTWo1Tt/euDEi6rapsdF4MvagH6R9w1x+VqKerI+blgHpQwTkH11uf4n+eHNbgyueOwAqzsPp0hl3LPGQz9yu/AUfXSMQ=
    - secure: ka0Mkj8/FXn/GQXbBpD73LLD0BdUj9NueDZuDlbP7eM4Yrh3ajRWqV0I/AMKMJYiVu81R6nkUxXeDKFYsFS8SA42/yotw8Pa+9yF2u/SrKwWbEZZb25bpUpAng2CDaG5A1HhkfxPlpjqOkPQm9oBWvdeC7EtHvoWtNF7uRe/7YzdIMCghyVq46uNfqb/ECtLGg+jJReAoOh1vu+EIb/lAWCOlF+07EHEdi1ubKz30l2vHA8nIaPSAA1oKb6inxz4vqD2fyB4144IKdZHFmc31Ljm2gAxFo7ivySfvC/nim0RARQY3uQz4zGuLqv++GKGzeymgH+Exq1vohmDFlMo95/lfi8C+dzz0Kjp8MagUetncTurs8RLPBTCD1iIvvndGz8T5PPgcChXpzFVTNuF1yJI0RluoG+hE23vz7Ey99iT/WuVaYH0DYibu/ZR02B+EqKKPvT4xCJxCitGh+nPLeMTY3nOhgeerTVjUyIJtSrHQxpMEY31BG6e1X1S2sHDyrOqU6qN3QAh9H2YKFW3clMkrBkUffx4s3AbgauiJBFb4LBIhTP4N2Y4w9T1mDiYKp7a6bOvvGLjsnMWu5cfxxlAvvxlqlRz20Qsbvd52Uvu1SEYuZTlBvMp7VOvHqBSMwJiqYUbz/3lvX1+x8QA3MewZsnus3hwUozQ7mLPJfk=
    - secure: nAf9AjuL0gia8NjDPY4I82mEKsY5cQqHv77kI471lxmTSWTxu/BN53ar+Q/MKjks5AKfwFgeg/jlbOtyM5+4p0Mn2xsOs23QQ3wpbeBud6t3aquu9bfEW+tagZ9fjQba1IeBaTDyTL/jf7ch08nkRGL+iaFXKxCvcEclWMwW49HiZzmicdtbXJJ113lYgMxNO5nAIaDdPB3dE6ROjXyYJldpsMY2lFG+hVuxPjAn8+SBbsprDb8xr5pnI27Y/7hgd2KZroSzfzAIZY9WGFCEZQFzutrdTM9DgOmM4T4kdUt90STsJ+PZeq5JOmtfr0xS8u7Uymj2cZBVWGcdufMFk3Lo2Ca/+aWHul3ebSO0/Fn/HtzN2gafsf8HJNsLPWOQUuLFjk4LNUusfJe/h3Ppk4JXPArMZcutWUraZzmIq+YeVfDN5T/wtsZzcVDEiPqYMHxk0fOL+l1+SFdla3BCSz/n9NsgfSy7sV3ESojfBhs4unl1LULE3pckT2bJ5eIpD3j+pC81LAtwu8T4owAfsPh3ft/n0P7bBgQyEA7wn7h8poQVn7kN8qeph9wN28f8cRSqnNmYWOC8Rx1aE5nrxuSeHu4y3Wbf+6ocNyvXT3t2Qm0VAsSO6Jr8zyeQi3tYvgRWI/vPiyTWjx6NRdwdEVYVf1J6gJvdHr6xKLaIPv0=
    - COMMIT=${TRAVIS_COMMIT::7}
    - secure: ndl9meriYXzjlwkcB3RduvhMMdVvMN7DBGdwL3L1LkpQ+VemMCI0dAHC4S9b5hYWdCtv2u49WhDSTh14BMHqc08VP4Xs0ToeL5S6m5ur+1VxT9knIMcELjAwmmUE/3jBB+YQaKNWpA9GF7TixgSzVsbxRS4p/R9X95tlAsZySKK2AqodjWt9Y12SaAd50uJ1qgkfo5voVjdZlwOAlVRNEuEdzUYHRKr1KWGGe4fYMiqWdLg8xYBKxVBRAortUgQ9Iu2Ky6O7vxLHUJTwx23HibsXrviUAFvqFCezk5Dc/+otlTtSIzHLwKktxcwo06ULyj8aRWj7+HnS+lN3GFwd6EhEdkOIwUgNs5qYD0BqE7Ck+iZH2pmlQpYNiqCBm2mjq9bs5yeIq9YQVU8YJEXpWV9kWYJ+pMBJviMJEcLifRcP88fgD/GLrGqjN0FoU55j6Xu1nrguu6rShHAY6A199IUSQ4TDgB/i2Gv7RQgP1xvr8cOmnNqttFGdBVToUb0c3VxH4M4zDaIExTEnGxjN8dqmZYa6CqcG5D538MT91dSUXw3KzjeckAJyQJO7kywamOdS3rCiF6eJ9Br/t8af8OzMeaAjaYNNXEDdx7NZfMjFgE9TdIHwkotipN1Vj6/nu4vIURo6nyx/2i7xkPeY7XWRJ7NXVR+2yBEoPMxcLI0=
    - secure: dMN2FaIdwFlTji+n5cx2/20gWf+A+BEdxdPG28os8JfLfblY49eIHMxJSaGYF/x7XWnwf1LzTM34QBuMAzz1wwglkeXpmSy+YNp9aAQFWM4Am9YdVX5ODddoqSD+dQx5QVgQLlxPObG5JDT2FS+VlSwyMvPuNDtAhLlbox6ANo8HG+9LpYrztE0lr8DdcBRkUrgplMlgRD/PGuk0Kzea6juxt080dihhGplUy+CADW6qRukEtdb7fYC0ZeYtlkbB/rxG0mkkMb9cNG1RHsha5fzlkoyG8RSMxWi8X2dFa80GSkK3gm1emBc56y1eYY6zQZFwgus+dcRhak329d2+I7xzdwuOFq+/huC0GFceQT11KVfrR0K16QfJ0xCdXsdSCHU+fwlrJzHG2nqynktjWnP/rkWauz8AadBl4LHVW39RtbdgdrS5GTKGcZeZGK/eYx6Rt+iMS8An4NKOhbPEyg/x7kf5AUzcydmWy53YGNYJpDZJwKsc7fxUPyNUaaFIZIju6NAMDlA780xDGBXW8p8+eS9orplk+YHrHdv3G35+CMYcIQ/O7S4apxTbTueh4Q1tH6ybzDsa1kIliFppueMzKx+xbC6MIuksPCkEDvb/rqXlMrBhBKriphZJJ4zKtbXCk5Ly23oxqzDVPf06sUjL1E0KLtxSc7ktpobkToc=
script:
  - ./gradlew clean test
  - ./gradlew jacocoFullReport
services:
  - docker
after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH;
    fi`
  - export IMAGE_NAME=ianarb/restaurant-looker-api
  - docker build -t $IMAGE_NAME:$COMMIT .
  - docker tag $IMAGE_NAME:$COMMIT $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME
deploy:
  - provider: s3
    access_key_id: $AWS_ACCESS_KEY
    secret_access_key: $AWS_SECRET_KEY
    local_dir: dpl_cd_upload
    skip_cleanup: true
    on: &1
      repo: IanArb/restaurant-buddy-api
      branch: master
    bucket: restaurant-looker-spring-boot
    region: eu-west-1
  - provider: codedeploy
    access_key_id: $AWS_ACCESS_KEY
    secret_access_key: $AWS_SECRET_KEY
    bucket: restaurant-looker-spring-boot
    key: restaurant-looker-server-SNAPSHOT-0.0.1.jar
    bundle_type: zip
    application: RestaurantLooker
    deployment_group: spring-boot-apps
    region: eu-west-1
    on: *1
    wait-until-deployed: true
  access_key_id:
    secure: A9rQ5IuNXoUokTlXgV2nOWqKa69tzo4t7DZtwbdLTrFwGRS9auhoOoHDmiNwrbqorAQ4uGAPLR5XkEvns7IqMa3IBzQ2FCd61aA06pJ4bg2SFNLmQ8wIPF28LNNyp63Uh2og1WFkCvf504VeXmorsgS9KfWrpsV+cFGUCJoHHGvr7HpFOwJ1t3wLhuEyoPSflKfNwHAFssMjc2QSWHfb6dkxrlwXz10aENgjrt72fJo4td90tdEtg2Fak1FuBEuRti2yQr/pRYcWTfWcXkxYlMPbFX5JsN14DvkxJTK9U0w1VPB401IM268Mujn7fw/sw74snskdF6oU+aAtkMSiLHZjC4d82ffKPpZYg/hTXWUrPLbsiwV5sVQzZDoRoBKxYoja7HIBTcPiotItamxpvQumHfp+8dTYajv2cVEUrk7FUzaQRo6kjbPBWXN6u0HkEBb/pA2WNQt9AcW22x3NQcaMw5RZ56VHmc7FbdWSB6WJ0X8sJ7rRflg7CwgYBvA2wEILXiBOTCcS99xJqQga3rAQ3w4nwPZRQQiqrGlEhPTTbwV4YUlNCYcZx/VPTs8GdOWYzLQml6EHrW9zGM8eFyH6xlDup0HDurG0bEewVGzpIj6JI5D755BMjjmi5QSypxYV/CkPn7B2v+UzjbhZXpCzVovj2BH1dSQ57Ts40iM=
  secret_access_key:
    secure: QyQzO2OuJEPFca3FIXvgXYPEeYsJqqDtDcH2DZK6UN8FDyLmCtO/1rz6HN38d+WCkkOES07UX2mbi6LbRj8Uk15t917gxYL+b/O8Sq0WWTVY0EozFeRZEI9FiHvPoDK3nEOt59X14uuzlnZSbXBzymraiVPTssBnX70BTko5vkDiDuW5jY5rDrAM9mVl/yznF7ia4JNrf8kVqBjNF+kRJqFKZHEWh8JsthMSoKCkDlyoSxQv8tqVqYRjf80lydr/Di4tg9gOO+4Y/RbTRK3Z5EU9JC7A/UjpOizntcRXl201LPsX7sOS5s82t0EPbkRoOMCi/rg4HY7lodP1/BJdhyw9tl98hI4xV7ft7qc+EAzqFHBRs3C1yvjIG636IO2nNBmYQ1cDY/Dy5kzbFv3f/0lio45wfZbtAGKHczICJ/oZ1Zy/dlJeQhJuuHay/lD4+aLHrZkW21x6FyjNPjp9vuETSFq3iQQ5doV48+zRv220Ry3hO3GvMf0h7EH+JckpsW267RAIAu9SkdavxnQncksrOlmfl7XXgD+gzuTAwa7hJLvSg9+xMxkHRqOnH30XNpwoxr0dXhziFpadY0k3LUzoOCMBhlL2Z8Oc43eG14PP1vGrw3fnlodeMjhTAx9RoqbiIZ/hUdLcAHkekjVjY9Y5BTkc9YuW2PiQyd8R0gs=