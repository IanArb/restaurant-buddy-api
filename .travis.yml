sudo: required
language : java
jdk: oraclejdk8

env:
  global:
  - DOCKER_USER="ian.arb"
  - DOCKER_PASS "QyzWABgCrEPCqiK8E+/RczZfdLqysjank3eHCZXUEIKUMDNFxA63mWzNltHsIJXWhI/8ojK+TEeScFW/SS6ADzWOuxx5DAvM1+P1eJPtZHsF0T51bT7/fEju/kBcxJz3uBuYwiw90udXJBcg+qK+iohTCUhrFwbSSAmwqYlX4Jx7bZyXD4p1Lgezmw/+IVD4hBPsvDlMadH4M/4mkFFoReQ6ir5co6N6INY6QrobOciGnTqfso2pwKfkQ0NFq3080iYKaD8bjE2xdDWiU0I/Om9g5DCb9aIzMJlmfPZmy2Bu/icfDtDdLSv4bEjg0q7pRCjf4VEoZ2RpNZJn8I4qlED3lLHGteiBFYfFf6AG4lHYdVf7OjCgDF/ix0fpJ8Wlx59lW1t01D04dWthrg4yjDPW0UCkrtmXKlc2PlNYQDllg0yWxFOQP2i5yDMdS59SdOnnfmlh42EKNnSbkwpoYb+UCuBdjbRHBChnoEzsX62urNWWUbsqX7fO6vckXpGg/s3698F5yH06lYC3gsJBvYaz0zH2T2IN5joYluqXb4w4KO+UYJbuLIeNECnr+hHAJ+vllbq7BMhstdeJSPOheaYcHWsro5Ydq7Oi+pZbckIh5+iy7XCNG8XJ1kO6xQboyaHhoy3WDLf5R5QpwKjIOtO8rPgDMvS+vjeqvxqb+BQ="
  - COMMIT=${TRAVIS_COMMIT::7}

script:
- ./gradlew clean test
- ./gradlew jacocoFullReport

services:
  - docker

after_success:
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
  - export IMAGE_NAME=ianarb/restaurant-looker-api
  - docker build -t $IMAGE_NAME:$COMMIT .
  - docker tag $IMAGE_NAME:$COMMIT $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME

#deploy:
#  provider: heroku
#  api_key: $HEROKU_API_KEY
#  app: blooming-basin-97212

